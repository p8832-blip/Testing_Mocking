# Ø§Ø³Ù… Ù…Ø³Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ (Workflow) Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© GitHub
name: Python CI Pipeline

# ØªØ­Ø¯ÙŠØ¯ Ù…ØªÙ‰ ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ Ù…Ø³Ø§Ø± Ø§Ù„Ø¹Ù…Ù„
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

# ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡Ø§
jobs:
  build_and_test:
    # ØªØ­Ø¯ÙŠØ¯ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
    runs-on: ubuntu-latest

    # ØªØ­Ø¯ÙŠØ¯ Ù…ØµÙÙˆÙØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµØ¯Ø§Ø±Ø§Øª Python Ù…ØªØ¹Ø¯Ø¯Ø©
    strategy:
      matrix:
        python-version: [ '3.11' ]

    # Ø®Ø·ÙˆØ§Øª ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©
    steps:
      # 1. Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: Checkout Code
        uses: actions/checkout@v4
      
      # 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¦Ø© Python
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      # 2.5. Ø¥Ø¶Ø§ÙØ© Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù„Ù‰ PYTHONPATH
      - name: Set PYTHONPATH
        run: |
          echo "PYTHONPATH=$GITHUB_WORKSPACE" >> $GITHUB_ENV

      # 3. ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª ÙˆØ£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
              pip install -r requirements.txt
          fi
          pip install pytest pytest-cov

      # âœ… 4. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø¹ ØªØºØ·ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
      - name: Run Pytest with Coverage
        run: |
          pytest --cov=Ø§Ø³Ù…_Ù…Ø¬Ù„Ø¯_Ø§Ù„ÙƒÙˆØ¯ --cov-report=xml --cov-report=term-missing tests/
      
      # âœ… 5. Ø±ÙØ¹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØºØ·ÙŠØ© ÙƒÙ€ Artifact (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      - name: Upload coverage report
        uses: actions/upload-artifact@v4
        with:
          name: coverage-report
          path: coverage.xml

      # 6. Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø§Ù„Ù†Ø¬Ø§Ø­
      - name: Final Success Message
        if: success()
        run: echo "ğŸ‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø§Ø¬Ø­Ø© Ø¹Ù„Ù‰ Python ${{ matrix.python-version }}!"
